---
import Button from './Button.svelte'
---
<form id="contact_form" name="contact" method="POST" data-netlify="true" action="/" class="w-full max-w-lg space-y-3">

  <div class="flex flex-wrap -mx-3">
    <div class="w-full px-3 md:mb-0">
      <label class="block uppercase tracking-wide text-gray-900 dark:text-white text-xs font-bold mb-2">
        Name
        <input type="text" name="name" class="appearance-none font-normal text-base block w-full bg-white bg-opacity-70 text-gray-900 border rounded mt-2 py-3 px-4 leading-tight focus:outline-none focus:bg-opacity-100" required>
      </label>
    </div>
  </div>

  <div class="flex flex-wrap -mx-3">
    <div class="w-full px-3 md:mb-0">
      <label class="block uppercase tracking-wide text-gray-900 dark:text-white text-xs font-bold mb-2">
        Subject
        <input type="text" name="subject" class="appearance-none font-normal text-base block w-full bg-white bg-opacity-70 text-gray-900 border rounded mt-2 py-3 px-4 leading-tight focus:outline-none focus:bg-opacity-100" required>
      </label>
    </div>
  </div>

  <div class="flex flex-wrap -mx-3">
    <div class="w-full px-3 md:mb-0">
      <label class="block uppercase tracking-wide text-gray-900 dark:text-white text-xs font-bold mb-2">
        Email
        <input type="email" name="email" class="appearance-none font-normal text-base block w-full bg-white bg-opacity-70 text-gray-900 border rounded mt-2 py-3 px-4 leading-tight focus:outline-none focus:bg-opacity-100" required>
      </label>
    </div>
  </div>  
  
  <div class="flex flex-wrap -mx-3">
    <div class="w-full px-3 md:mb-0">
      <label class="block uppercase tracking-wide text-gray-900 dark:text-white text-xs font-bold mb-2">
        Message
      </label>
      <textarea name="message" class="appearance-none font-normal text-base block w-full bg-white bg-opacity-70 text-gray-700 h-40 border rounded mt-2 py-3 px-4 leading-tight focus:outline-none focus:bg-opacity-100" required></textarea>
    </div>
  </div>

  <div class="pt-3">
    <Button type="submit" style="Primary" link="">Send</Button>
  </div>

  <div class="response pt-3 pb-3 pl-3 !mt-6 opacity-0 border-l-4 dark:text-white transition-all"></div>

</form>

<style lang="scss">
  .response{
    &.success, &.failure{
      opacity: 1;
    }
    &.success{
      border-color: rgb(var(--successColor));
      background-color: rgba(var(--successColor), 0.5);
    }
  }
</style>

<script lang="ts">
  let netlifyForm = document.querySelector("#contact_form");
  let netlifyFormResponse = document.querySelector("#contact_form .response");
  netlifyForm.addEventListener('submit', e => {
    e.preventDefault();
    const formData = new FormData(netlifyForm);
    fetch(netlifyForm.getAttribute('action'), {
      method: 'POST',
      headers: {
        'Accept': 'application/x-www-form-urlencoded;charset=UTF-8',
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
      },
      body: new URLSearchParams(formData).toString()
    })
    .then(res => {
      if (res) {
        // console.log("Form sent", res)
        // console.log("Status", res.status)
        // console.log("Ok", res.ok)
        if(res.status === 200 && res.ok === true){
          netlifyFormResponse.innerHTML = "Thanks for your message!"
          netlifyFormResponse.classList.add('success')
          netlifyForm.reset()
        }else{
          netlifyFormResponse.innerHTML = "Uh-oh... We had problems trying to deliver your message"
          netlifyFormResponse.classList.add('failure')
        }
      }
    });
  });
</script>