---
import Title from '../components/Title.svelte'
import ProjectPreview from '../layouts/ProjectPreview.astro'
import ConditionalLoading from '../components/ConditionalLoading.svelte'
import Blobs from '../components/Blobs.svelte'

// Data Fetching: Get section markdown file
let contentData = await Astro.glob('../pages/singular/projects.md');
let content = contentData[0]

// Data Fetching: List all Markdown projects in the repo.
let allProjects = await Astro.glob('../pages/projects/*.md');
allProjects.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf());
let firstProjects = allProjects.slice(0, 3);
---

<ConditionalLoading load={content.frontmatter.active}>
  <section class="py-32 relative">

    <div class="absolute w-5/12 h-1/3 right-0 bottom-1/3">
      <Blobs/>
    </div>
    
    <div class="container mx-auto px-6 relative z-10">

      <div class="w-full space-y-8 z-10">

        <Title>
          <span slot="title">
            {content.frontmatter.title}
          </span>
          <span slot="subtitle">
            {content.frontmatter.description}
          </span>
        </Title>

      </div>

    </div>

    <div class="container mx-auto px-6 flex gap-8 relative z-10">

      {firstProjects.map((project) => <ProjectPreview project={project} />)}

    </div>

  </section>
</ConditionalLoading>